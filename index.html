<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Invest Robot – تسجيل / دخول</title>
  <style>
    /* --- أساسيات التصميم --- */
    :root {
      --bg-start: #1e0d47;
      --bg-end: #100622;
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-border: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      --text-muted: #c9c9d1;
      --input-bg: rgba(255, 255, 255, 0.07);
      --btn-start: #b6a6ff;
      --btn-end: #9affdd;
      --radius: 14px;
    }
    * { box-sizing: border-box; font-family: "Tajawal", sans-serif; }
    body {
      margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.05) 0 120px, transparent 200px),
                  radial-gradient(circle at 90% 70%, rgba(255,255,255,0.05) 0 150px, transparent 260px),
                  linear-gradient(180deg, var(--bg-start), var(--bg-end));
      color: var(--text-main);
    }
    .container { width: 100%; max-width: 480px; padding: 2rem 1rem 4rem; text-align: center; }
    .logo { width: 100px; margin: 0 auto 0.5rem; }
    h1 { margin: 0 0 2rem; font-size: 1.6rem; font-weight: 600; }
    .card { background: var(--card-bg); border: 1px solid var(--card-border); backdrop-filter: blur(10px); border-radius: var(--radius); padding: 2rem 1.2rem; }
    input {
      width: 100%; padding: 0.95rem 1rem; border: none; border-radius: var(--radius);
      background: var(--input-bg); color: var(--text-main); font-size: 0.9rem; outline: none;
    }
    input::placeholder { color: var(--text-muted); }
    .btn {
      border: none; cursor: pointer; padding: 0.95rem 1rem; font-size: 1rem; font-weight: 600; border-radius: var(--radius);
      background: linear-gradient(to left, var(--btn-start), var(--btn-end)); color: #000; transition: transform 0.2s;
    }
    .btn:active { transform: scale(0.97); }
    .link { color: var(--btn-end); cursor: pointer; text-decoration: none; }
    .small-text { font-size: 0.85rem; color: var(--text-muted); }
    .hidden { display: none; }
    .tabs { display: flex; margin-bottom: 1.8rem; }
    .tab {
      flex: 1; padding: 0.9rem 0; cursor: pointer; font-size: 0.9rem; color: var(--text-muted);
      position: relative; transition: color 0.3s;
    }
    .tab.active { color: var(--text-main); }
    .tab.active::after {
      content: ""; position: absolute; bottom: 0; left: 10%; width: 80%; height: 2px;
      background: var(--btn-end); border-radius: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo.png.jpg" class="logo" alt="logo">
    <h1>AI Invest Robot</h1>
    <!-- تبويبات الدخول والتسجيل -->
    <div class="tabs">
      <div id="loginTab" class="tab active">تسجيل الدخول</div>
      <div id="registerTab" class="tab">إنشاء حساب</div>
    </div>

    <!-- نموذج تسجيل الدخول -->
    <div id="loginCard" class="card">
      <form id="loginForm">
        <input id="loginEmail" type="email" placeholder="البريد الإلكتروني" required>
        <input id="loginPass" type="password" placeholder="كلمة المرور" required style="margin-top: 1.1rem;">
        <button class="btn" type="submit" style="margin-top:1.4rem; width: 100%;">دخول</button>
      </form>
      <p id="loginWarning" class="small-text hidden" style="color: #ff4d4f; margin-top: 0.8rem;">
        البريد الإلكتروني أو كلمة المرور غير صحيحة
      </p>
      <p class="small-text" style="margin-top:1rem;">
        ليس لديك حساب؟ <span id="goRegister" class="link">أنشئ حساب</span>
      </p>
    </div>

    <!-- نموذج التسجيل -->
    <div id="registerCard" class="card hidden">
      <form id="registerForm">
        <input id="regEmail" type="email" placeholder="البريد الإلكتروني" required>
        <input id="regPass" type="password" placeholder="كلمة المرور" required style="margin-top: 1.1rem;">
        <input id="regPass2" type="password" placeholder="تأكيد كلمة المرور" required style="margin-top: 1.1rem;">
        <button class="btn" type="submit" style="margin-top:1.4rem; width: 100%;">تسجيل</button>
      </form>
      <p class="small-text" style="margin-top: 1rem;">
        لديك حساب؟ <span id="goLogin" class="link">سجّل دخول</span>
      </p>
    </div>
  </div>

  <script>
    // رابط Google Apps Script
    const scriptURL = "https://script.google.com/macros/s/AKfycbyHpA8Th9zMYD8GimZa-m_p4myJs5OJghGV3U_X9FT_3GQ37ylLCuzNJsviOwMEEkU8/exec";

    // عناصر التبويبات والنماذج
    const loginTab = document.getElementById("loginTab");
    const registerTab = document.getElementById("registerTab");
    const loginCard = document.getElementById("loginCard");
    const registerCard = document.getElementById("registerCard");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");
    const loginWarning = document.getElementById("loginWarning");

    // تبديل العرض بين نماذج الدخول والتسجيل
    document.getElementById("goRegister").addEventListener("click", () => switchScreen(false));
    document.getElementById("goLogin").addEventListener("click", () => switchScreen(true));
    loginTab.addEventListener("click", () => switchScreen(true));
    registerTab.addEventListener("click", () => switchScreen(false));

    function switchScreen(isLogin) {
      loginTab.classList.toggle("active", isLogin);
      registerTab.classList.toggle("active", !isLogin);
      loginCard.classList.toggle("hidden", !isLogin);
      registerCard.classList.toggle("hidden", isLogin);
      loginWarning.classList.add("hidden");
    }

    // معالجة التسجيل
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("regEmail").value.trim();
      const pass1 = document.getElementById("regPass").value;
      const pass2 = document.getElementById("regPass2").value;
      if(pass1 !== pass2) {
        alert("كلمتا المرور غير متطابقتين");
        return;
      }
      
      try {
        const res = await fetch(`${scriptURL}?action=register&email=${encodeURIComponent(email)}&password=${encodeURIComponent(pass1)}`);
        const responseData = await res.json();
        if(responseData.status === "success"){
          alert("تم التسجيل بنجاح! يمكنك الآن تسجيل الدخول.");
          switchScreen(true);
        } else {
          alert("خطأ أثناء التسجيل: " + responseData.message);
        }
      } catch (error) {
        alert("حدث خطأ أثناء الاتصال. حاول مرة أخرى.");
        console.error(error);
      }
    });

    // معالجة تسجيل الدخول
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      loginWarning.classList.add("hidden");
      const email = document.getElementById("loginEmail").value.trim();
      const pass  = document.getElementById("loginPass").value;
      
      try {
        const res = await fetch(`${scriptURL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(pass)}`);
        const responseData = await res.json();
        if(responseData.status === "success"){
          // يمكنك حفظ بيانات المستخدم محلياً إن أردت
          localStorage.setItem("loggedUser", email);
          localStorage.setItem("referralCode", responseData.referral_code);
          window.location.href = "home.html";
        } else {
          loginWarning.classList.remove("hidden");
        }
      } catch (error) {
        alert("حدث خطأ أثناء الاتصال. حاول مرة أخرى.");
        console.error(error);
      }
    });
  </script>
</body>
</html>
